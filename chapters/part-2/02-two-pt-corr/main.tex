\chapter{Two-point correlator}
\label{ch:p2:2pt-corr}

\readit{3}

\worktodo{
* 2pt corr
  * estimators
    * basically different prop decomps
    * point prop
    * stochastic prop
      * spin diagonal
      * time dilution
    * LMA prop? in the traditional formulation, eq (12) in lma-final.tex
}

\tldr{intro}
We will introduce the light-quark connected meson correlator -- the observable of interest -- in this chapter.
The spacetime lattice with all degrees of freedom is formally introduced (\cref{sec:lattice:definition}) before the two-point correlator is brought into a form suitable for computational evaluation (\cref{sec:2pt-corr}) followed by a discussion of common evaluation strategies.
The chapter ends with a brief summary (\cref{sec:2pt:summary}).
% culminating in an analysis of low-mode averaging applied to it, its problems in terms of its unfortunate quadratic volume scaling and challenges that emerge when evaluating the remaining pieces not attributed to the low modes.





%\section{g-2}

% \worktodo{
% * motivate g-2, amu
% * derive amu = int ...
% * show cake-diagram of HVP contribution to total error, connected contribution to HVP -> motivate observable
% * focus on two-point connected vector correlator
% }

% In search of new fundamental physics, lattice field theory can non-perturbatively predict physical quantities using first principles to directly probe the standard model (SM) of particle physics.
% This is to search for indirect proofs of its validity.
% A strong-enough tension with an experimental quantity would proof the standard model is not sufficient to describe fundamental interactions.
% One hopes to find an observable where physics not described by the standard model has non-negligible influence in its value.
% One such quantity which became very prominent in the last years is the the anomalous magnetic moment of the muon, whose beyond the standard model (BSM) effects might arise from unknown virtual particles outside the energy range of modern particle colliders.
% For many years now, it is a promising candidate and gave hints for BSM physics, because of its longstanding tension between the SM prediction and experiment of about $3-4 \sigma$ \cite{snowmass:2020} very close to a discovery.
% Although current results seem to relax the tension, but they introduce new puzzles from tensions between data-driven and lattice determinations~\cite{snowmass:2025}.
% Light may be shed on those questions by decreasing error bars from both theory and experiments resulting in a resolution or tightening of the tension and ultimately a better understanding of nature.
% Dominant sources of error come from the leading order (LO) hadronic vacuum polarization (HVP) term at order $\bigO(\alpha^{2})$ and the subdominant hadronic light-by-light scattering (HLbL) term at order $\bigO(\alpha^{3})$.
% %It seems to be promising candidate to lead to an indirect evidence for beyond the standard model (BSM) physics.

% \section{The anomalous magnetic moment}

% Due to their charge, leptons create a magnetic field around them leading to a magnetic dipole moment.
% A classical charged point particle moving on a circular orbit generates a dipole magnetic moment $\vect{\mu}$ that is proportional to its orbital angular momentum $\vect{L}$ by
% \begin{equation}
% \vect{\mu} = \frac{q e}{2 m} \vect{L}.
% \end{equation}
% where $e$ is the elementary charge, $q$ and $m$ are the integer charge and mass of the particle.
% In quantum mechanics angular momenta $\vect{L}$ are quantized and for a \spinhalf particle we may replace the angular momentum operator $\vect{L}$ by the spin angular momentum $\vect{S}$ which contributes to the angular momentum and is quantized in steps of size $\hbar/2$.
% Therefore we find for the magnetic moment of a \spinhalf particle
% \begin{equation}
% \vect{\mu} = g \frac{q e}{2 m} \vect{S}.
% \end{equation}
% We have sneaked in a dimensionless proportionality factor $g$ here.
% Classically we would clearly expect $g=1$ if spin behaved like angular momentum.
% However, when interacting with an electromagnetic field, the relativistic treatment leads to an additional term that doubles the expected magnetic moment.
% This magnetic moment can be characterized in terms of the dimensionless Land√© g-factor also known as the gyro-magnetic ratio, parametrized by $g$ in the formula above.
% In 1928, Dirac formulated the Dirac equation for relativistic \spinhalf particles and derived their magnetic moment~\cite{dirac1928quantum}.
% He obtained the g-factor to be $g=2$ exactly.
% This result is independent of the mass and holds for every fundamental \spinhalf particle including the electron, muon, tau and even the quarks\footnote{It does not hold for composite \spinhalf particles like the proton or neutron because they are not point-like; an assumption in Dirac's derivation.}.
% The anomalous magnetic moment is defined as the deviation of the g-factor from its tree level result encoding the effects of relativistic quantum field theory,
% \begin{equation}
% a_{\ell} = \frac{g_{\ell}-2}{2}.
% \end{equation}
% The one-loop correction to the electron $a_{e} = \frac{\alpha}{2 \pi}$ was already calculated analytically in 1948 by Schwinger~\cite{Schwinger:1948}.
% Impressive advancements of higher order corrections up to $\bigO(\alpha^{5})$ (\ie to tenth order in $e$!) have been carried out since then for the electron~\cite{laporta1996analytical,PhysRevLett.109.111807,PhysRevD.91.033006,nio2015qed}.

% \section{Which lepton?}

% Since all virtual particles contribute to the magnetic moment, it can be argued~\cite{osti_4382322} that corrections $\delta a_{\ell}$ to the anomalous magnetic moment of leptons scale with the mass as
% \begin{equation}
% \delta a_{\ell} \sim \frac{m_{\ell}^{2}}{\Lambda^{2}},
% \end{equation}
% where $m_{\ell}$ is the mass of the lepton and $\Lambda$ is the energy scale where new physics appear, \ie roughly the mass of a new unknown heavy virtual particle.
% This suggests that the anomalous magnetic moment of the heaviest known lepton, the tau with a mass of about \SI{1.8}{\GeV} (see \cref{tab:leptons}), should be the best candidate to lead to new physics.
% Admittedly the tau is very short lived with a lifetime of about \num{0.3} pico-seconds making it hard to access in experiments.
% Nevertheless it is being investigated~\cite{Fael:2013ij,BaBar:2015ard} as an alternative path to new physics.
% The lepton with the longest lifetime, the electron with a lifetime of many years is unfortunately very light and thus unlikely to produce heavy virtual particles.
% This leaves the muon with a lifetime accessible to nowadays experiments and a squared mass of about forty thousand times the one of the electron making it the most promising candidate for indirect new physics searches~\cite{jegerlehner2009muon}.

% \begin{table}
% \begin{tabular}{ccc}
% \toprule
% Lepton $\ell$ & Mass & Lifetime [s] \\
% \midrule
% Electron &
% 0.51099895069(16) eV~\cite{codata:2022} &
% \num{2.13965d11}~\cite{PhysRevLett.115.231802} \\
% \midrule
% Muon &
% 105.6583755(23) MeV~\cite{codata:2022} &
% \num{2.1969811d-6}~\cite{beringer2012pdg,Patrignani_2016} \\
% \midrule
% Tau &
% 1.77686(12) GeV~\cite{codata:2022,PhysRevD.98.030001} &
% \num{2.903d-13}~\cite{PhysRevD.98.030001} \\
% \bottomrule
% \end{tabular}
% \caption{\label{tab:leptons}
% Lepton masses and their mean lifetimes.}
% \end{table}

% \section{Which contribution?}

% As stated previously, the largest error contribution stems from the LO-HVP contribution to the anomalous magnetic momentum of the muon.
% As the current SM prediction~\cite{snowmass:2020} includes the data-driven result for this contribution, the next iteration of will most likely include its lattice determination.
% The reasons for this are manifold.
% The data-driven result -- in tension with the experimental value~\cite{Muong-2:2006rrc,Muong-2:2021ojo} -- is itself obtained using experimental data, namely from the cross-section $\sigma(e^{+} e^{-} \rightarrow \text{hadrons})$ as a function of the center of mass energy $\sqrt{s}$~\cite{davier:2017zfy,keshavarzi:2018mgv,colangelo:2018mtw,hoferichter:2019mqg,davier:2019can,keshavarzi:2019abf}.
% This is certainly not a first principles theory prediction, but was until recently the only one whose error was competitive with the experimental error estimations.
% Algorithmic, theoretical and computational advancements over the years made the quantity accessible in the framework of lattice QCD.
% It is thus to be expected that future muon $g-2$ Theory Initiative releases will not only include a lattice result for the HVP as of now, but also make it part of the official consensus result.
% %whose error quickly become comparable to the data-driven approach.
% This work will focus on the leading order hadronic vacuum polarization contribution $a_{\mu}^{\text{LO-HVP}}$ to the muon $g-2$ which renders the most challenging contribution to reduce the variance of.

% \section{The leading order HVP contribution}
% \label{sec:lo-hvp}

% The goal of the muon $g-2$ Theory Initiative is to reach a relative error contribution to the whole LO-HVP in the regime of a per mill.
% This poses an immense challenge theoretical, algorithmic and computational.
% Compared to hadronic scales the muon mass is small, implying the largest contribution to $a_{\mu}$ must come from large distances.

% The observable of interest in this part of the document is the connected two-point isovector vector current correlator in the time-momentum representation \cite{Bernecker:2011}.
% The local electromagnetic vector current is defined as
% \begin{align}
% j_{\mu}(x) = q \bar{\psi}(x) \gamma_{\mu} \psi(x),
% \quad
% \mu=0,1,2,3
% \end{align}
% where $q$ is the charge of the quark, $\psi$ is the Grassmann-valued quark spinor field and $\gamma_{\mu}$ exposes the quantum numbers of a vector particle. From this current, we can define the two-point function
% \begin{align} \label{eq:C_corr_xy}
% C_{\mu \nu}(x;y) = \langle j_{\mu}(x) j_{\nu}(y) \rangle,
% \end{align}
% with a source $y$ and a sink $x$.
% In order to relate this quantity to the energy states of the system, we perform the Fourier transform over the spatial components of the sink variable $x$, project to zero momentum, average over the spatial components of the current and exploit translation invariance of the expression by averaging over some (at this point unspecified) set of distinct source points $y \in \Omega$,
% \begin{align}
% %G_y(t) = - \frac{1}{3} \sum_{k=1}^{3} \int \dd^3 \vect{x} \; C_k(t + y_0, \vect{x}; y).
% C(x_0;y_0) = - \frac{1}{3 \lvert \Omega \rvert} \sum_{y \in \Omega} \sum_{k=1}^{3} \int \dd^3 \vect{x} \; C_{kk}(x; y).
% \end{align}
% Furthermore, the correlation function only depends on the time difference $t = x_0 - y_0$ and we finally define the Euclidean time correlator
% %where $t$ is the time difference between the two spacetime points $(t + y_0, \vect{x})$ and $y$.
% %We can exploit translation invariance of the expression and average over some points $y \in \Omega$,
% \begin{align} \label{eq:coor1}
% G(t) = - \frac{1}{3 \lvert \Omega \rvert} \sum_{y \in \Omega} \sum_{k=1}^{3} \int \dd^3 \vect{x} \; C_k(t+y_0, \vect{x}; y).
% \end{align}

% The LO-HVP contribution can then be written as~\cite{Bernecker:2011}
% \begin{equation}
% a_{\mu}^{\text{LO-HVP}} = 
% \left( \frac{\alpha}{\pi} \right)^{2}
% \int_{0}^{\infty} \dd t \; G(t) K(t; m_{\mu})
% \end{equation}
% where $K(t; m_{\mu})$ is a known analytic kernel function for the leading order depending on the time $t$ and the muon mass $m_{\mu}$ only and is given by
% \begin{align}
% K(t; m_{\mu}) &= 
% 8 \pi^{2} \int_{0}^{\infty} \frac{\dd \omega}{\omega} f(\omega^{2}) \left[
% \omega^{2} t^{2} - 4 \sin^{2}\left(\frac{\omega t}{2}\right)
% \right],
% \end{align}
% with~\cite{Blum:2004cq}
% \begin{equation}
% f(\omega^{2}) = 
% \frac{m_{\mu}^{2} \omega^{2} Z^{3} (1 - \omega^{2} Z)}{1 + m_{\mu}^{2} \omega^{2} Z^{2}},
% \quad
% Z =
% - \frac{\omega^{2} - \sqrt{ \omega^{2} + 4 m_{\mu}^{2} \omega^{2} }}{ 2 m_{\mu}^{2} \omega^{2} }.
% \end{equation}

The observable of interest in this part is the the connected leading order hadronic vacuum polarization contribution (LO-HVP) to the anomalous magnetic moment of the muon as introduced in \cref{sec:intro:gm2}.
The connected LO-HVP piece which dominates the error budget is itself a comparably simple observable, but suffers from the signal-to-noise ratio problem.
The piece we calculate on the lattice is the Euclidean time correlator \cref{eq:coor1}, which in a post-processing phase enters the main integral for the connected LO-HVP contribution \cref{eq:a:mu:lohvp}.
Before we move on, we need to define the degrees of freedom on a spacetime lattice.

\section{Lattice definition}
\label{sec:lattice:definition}

\tldr{lattice definition}
We define a \df{lattice} $\lattice$ as the set of its indices.
The fine-grid lattice is defined as the triple $\lattice = (\idxspacetime, \idxspin, \idxcolor)$ and its index set is the cross-product $\idxset = \idxspacetime \times \idxspin \times \idxcolor$ with
\begin{align}
\begin{aligned}
\text{the spacetime lattice }
    \idxspacetime &= \idxtime \times \idxspace \;, \\
\text{the temporal lattice }
    \idxtime  &= \exptime \;, \\
\text{the spatial lattice }
    \idxspace &= \expspace \;, \\
\text{the spins }
    \idxspin  &= \expspin \;, \\
\text{the colors }
    \idxcolor &= \expcolor \;,
\end{aligned} \label{eq:index:sets}
\end{align}
where $\Lt,L_i,N_s,\Nc \in \mathbb{N}$.
The product $V = \Lt \Lx \Ly \Lz$ is called the \df{lattice volume}, whereas the product $N_s \Nc$ parametrizes the internal degrees of freedom of a spinor field on each lattice point.
The product of the two $d = V N_s \Nc$ gives us the dimension over the complex numbers $\mathbb{C}$ of spinor fields and operators acting on spinor fields on the lattice.
The native lattice where fermion fields live with $(N_s, \Nc) = (4,3)$, we will call the \df{fine-grid lattice} $\lattice$.
Furthermore, the Hilbert space of spinor fields $\vslattice$ is the tensor product of Hilbert spaces,
\begin{equation}
\vslattice = \mathcal{H}_{L_0} \otimes \mathcal{H}_{L_1} \otimes \mathcal{H}_{L_2} \otimes \mathcal{H}_{L_3} \otimes \mathcal{H}_{N_s} \otimes \mathcal{H}_{N_c} \cong \mathbb{C}^{d} \;,
\end{equation}
where each individual space corresponds to an index set in \cref{eq:index:sets} and is isomorphic to $\mathcal{H}_{N} \cong \mathbb{C}^{N}$.
We note, the Dirac operator which is an endomorphism on this Hilbert space, $D \colon \vslattice \rightarrow \vslattice$, is not separable into a tensor product, because its action to a spinor field couples and mixes all individual degrees of freedom non-trivially, compare \cref{eq:Dw:QCD+QED}.

\section{Two-point correlator}
\label{sec:2pt-corr}

To obtain a formula which we can evaluate on a computer, we perform a Wick contraction of \cref{eq:C_corr_xy} on the lattice.
% \begin{align}
% C_{\mu \nu}(x;y) = \langle j_{\mu}(x) j_{\nu}(y) \rangle \;,
% \end{align}
We will use Wick's theorem ($\prop = D^{-1}$ is the quark propagator)
\begin{equation}
\langle \fieldxaa{\psi}{x}{\alpha}{a} \fieldxaa{\bar{\psi}}{y}{\beta}{b} \rangle =
a^{-4} \propxyab{x}{y}{\alpha}{\beta}{a}{b} \;,
\end{equation}
to get rid of the Grassmann fields and obtain an expression in terms of quark propagators\footnote{We note that continuum objects like the spinor field $\psi(x)_{\alpha \atop a}$ will have a discretized lattice analogue $\psi[x]_{[\alpha] \atop [a]}$, emphasizing that spinors are just vectors with a multi-index or multi-dimensional arrays put on a computer.}.
We obtain connected and disconnected contributions,
\begin{align}
C_{\mu \nu}(x;y) &= C_{\mu \nu}^{\text{conn}}(x;y) + C_{\mu \nu}^{\text{disc}}(x;y) \;, \\
C_{\mu \nu}^{\text{conn}}(x;y) &=
\tr \left\{
  \propxy{x}{y} \gamma_{\mu} \propxy{y}{x} \gamma_{\nu}
\right\} \;, \label{eq:C_corr_Dinv:connected} \\
C_{\mu \nu}^{\text{disc}}(x;y) &=
\tr \left\{ \propxy{x}{x} \gamma_{\mu} \right\}
\cdot
\tr \left\{ \propxy{y}{y} \gamma_{\nu} \right\} \;,
\end{align}
where the trace is over color and spin indices.
As motivated in \cref{sec:intro:motivation}, we will concentrate on the connected (light-quark) piece, that contributes about 98\% of the value of $a_{\mu}^{\text{LO-HVP}}$ and 97\% to the variance (see \cref{fig:a_mu:sm:variances,fig:a_mu:lohvp:variances} and ref.~\cite{snowmass:2025}).
On the lattice the Fourier integral of the connected bare isovector vector correlator, \cref{eq:coor1}, turns into a sum over spatial lattice points and can be evaluated using the result in \cref{eq:C_corr_Dinv:connected} as
\begin{equation} \label{eq:G:corr:connected}
G^{\text{conn}}(t) =
- \frac{a^{3}}{3 \lvert \Omega \rvert}
\sum_{y \in \Omega}
\sum_{\vect{x}} \;
\sum_{k=1}^{3}
\tr \left\{
  \propxy{t+y_0, \vect{x}}{y} \gamma_k \propxy{y}{t+y_0, \vect{x}} \gamma_k
\right\} \;.
\end{equation}
This is the form suitable for computational evaluation.
There are many strategies to evaluate this observable.
In the following we will discuss some of them.

\subsection{Point propagator}
\label{sec:point:prop}

The most straightforward way to evaluate \cref{eq:G:corr:connected} is by using point sources. They are defined to be fields which have support only on one single lattice point $y$, spin $\beta$ and color $b$, \ie they are standard basis vectors. With these sources as right-hand sides, we solve the Dirac equation \num{12} times, once for each color-spin combination
\begin{equation} \label{eq:pt:prop:system}
D \psi^{y, \beta, b} = \eta^{y, \beta, b} \,,
\quad
\beta = 0,1,2,3 \;,
\quad
b = 0,1,2 \;.
\end{equation}
In this equation $\eta^{y, \beta, b}$ is a point source,
\begin{equation}
%\eta^{y, \beta, b}(x)_{\alpha \atop a} = \delta_{\alpha \beta} \delta_{ab} \delta_{xy},
\fieldxaa{\eta^{y, \beta, b}}{x}{\alpha}{a} = \delta_{\alpha \beta} \delta_{ab} \delta_{xy} \;,
\end{equation}
and the solution $\psi^{y, \beta, b} = D^{-1} \eta^{y, \beta, b}$ is the column of the matrix $D^{-1}$ corresponding to source index $(y, \beta, b)$.
This allows us to define the propagator -- the Green's function to the lattice Dirac operator -- in terms of solutions to \cref{eq:pt:prop:system}, explicitly
\begin{equation} \label{eq:prop:pt-to-all}
\propxyab{x}{y}{\alpha}{\beta}{a}{b} = \fieldxaa{\psi^{y, \beta, b}}{x}{\alpha}{a} \;.
%\quad \beta = 0,1,2,3 \;, \quad b = 0,1,2 \;.
\end{equation}
Since this equality holds for fixed source point $y$ but open spin and color indices $\alpha, \beta, a, b$ and open lattice sink point $x$, the above is called the \df{point-to-all propagator}.
This not an approximation but an exact equation.
It makes it possible to evaluate \cref{eq:G:corr:connected} for some restricted set of source points $y \in \Omega$.

We note that one may increase the precision by adding more distinct points to the set $\Omega$, but every source point amounts \num{12} solves of the Dirac equation, which might quickly become expensive.
However the cost of this estimator -- and by this its precision -- is under control of the user and can be improved arbitrarily even post hoc.
Ideal would be to include all lattice points in $\Omega$, resulting in a volume average and minimal variance but the cost for this is impracticable.

\subsection{Stochastic propagator}
\label{sec:stochastic:prop}

Instead of an exact evaluation as in the previous section, we can introduce a stochastic estimator for \cref{eq:G:corr:connected}.
We apply the Hutchinson method for estimating the trace of an inverse matrix~\cite{Hutchinson01011990,Michael:1998sg}.
Our noise vectors have to be diluted in time-direction, because of the fact that in \cref{eq:G:corr:connected} the sink time $x_0 = t + y_0$ is shifted relative to the source time $y_0$ and thus depends on it.
We cannot add a stochastic identity in time.
This means that we use $\Nst$ stochastic noise sources $\eta_n^{\tslice{t_n}}$ distributed uniformly in time with support only on a certain time slice given by $t_n \in \stime$,
\begin{equation} \label{eq:stoch:time_dilution}
\fieldx{\eta^{\tslice{z_0}}_n}{x} = 0
\quad
\text{unless } z_0 = x_0 \;.
\end{equation}
The sources have zero mean
\begin{equation}
\lim_{\Nst \to \infty}
  \frac{1}{\Nst}
    \sum_{n=0}^{\Nst-1}
      \fieldxaa{\eta^{\tslice{z_0}}_{n}}{x}{\alpha}{a}
 = 0 \;,
\end{equation}
and unit variance
\begin{equation}
\lim_{\Nst \to \infty}
  \frac{1}{\Nst}
    \sum_{n=0}^{\Nst-1}
      \fieldxaa{\eta^{\tslice{z_0}}_{n}}{x}{\alpha}{a}
      \left( \fieldxaa{\eta_n^{\tslice{z_0}}}{y}{\beta}{b} \right)^{\dagger}
=
\delta_{\alpha \beta} \;
\delta_{ab} \;
\delta_{\vect{x} \vect{y}} \;
\delta_{x_0 z_0} \;
\delta_{y_0 z_0} \;.
\end{equation}
The noise can be any (sub-)Gaussian set of noise for instance \ggrp{U}{1} or $\mathbb{Z}_2 = \{-1, 1\}$.
This allows us to write a stochastic identity in spin, color and space at (for now) fixed time slice $z_0$ as
\begin{equation} \label{eq:stoch:id}
\lim_{\Nst \to \infty}
  \frac{1}{\Nst}
    \sum_{n=0}^{\Nst-1}
      \eta_n^{\tslice{z_0}}
      (\eta_n^{\tslice{z_0}})^{\dagger}
= \id_{\idxspin} \otimes \id_{\idxcolor} \otimes \id^{\tslice{z_0}}_{\idxspacetime}
\equiv \id^{\tslice{z_0}}_{\text{st}} \;,
\end{equation}
with the identities on the tensor spaces %\worktodo{symbols not introduced yet}
\begin{align}
(\id_{\idxspin})_{[\alpha \beta]} &= \delta_{\alpha \beta} \;,
&\text{for } \alpha, \beta &\in \idxspin \;, \\
(\id_{\idxcolor})_{[ab]} &= \delta_{ab} \;,
&\text{for } a, b &\in \idxcolor \;, \\
\opxy{\id^{\tslice{z_0}}_{\idxspacetime}}{x}{y} &= \delta_{\vect{x} \vect{y}} \; \delta_{x_0 z_0} \; \delta_{y_0 z_0} \;,
&\text{for } x, y &\in \idxspacetime, z_0 \in \idxtime \;.
\end{align}
%$(\id_{\idxspin})_{\alpha \beta} = \delta_{\alpha \beta}$, $(\id_{\idxcolor})_{ab} = \delta_{ab}$ and $\id^{(z_0)}_{\idxspacetime}(x|y) = \delta_{\vect{x} \vect{y}} \; \delta_{x_0 y_0 z_0}$.
We notice that if $\Nst < \infty$, \cref{eq:stoch:id} is not an equality.
Evaluating observables with it will introduce non-negligible stochastic noise on top of the gauge noise from the estimator itself which has to be taken care of when estimating errors.
However, the identity \cref{eq:stoch:id} can be plugged in \cref{eq:G:corr:connected} at any place.
All choices are equivalent in terms of computational cost.
The stochastic estimator inherently introduces a spatial lattice volume average on time slice $z_0$, \ie $\lvert \Omega \rvert = \lvert \idxspace \rvert = L_1 L_2 L_3$.
It can be seen as a stochastic all-to-all propagator on a fixed time slice $z_0$.
Upon including all time slices, it is truly a stochastic all-to-all propagator.
Thus by plugging in the stochastic identity, we find
\begin{align}
C(x_0, y_0)
&= \frac{1}{ \lvert \Sigma \rvert } \sum_{\vect{x}, \vect{y}} \;
\tr \left\{ \propxy{x}{y} \gamma_k \propxy{y}{x} \gamma_k \right\} \\
&= \frac{1}{ \lvert \Sigma \rvert } \sum_{\vect{x}, w, z} \;
\tr \left\{
  \propxy{x}{w} \gamma_k
  \opxy{\id^{\tslice{y_0}}_{\text{st}}}{w}{z}
  \propxy{z}{x} \gamma_k
\right\} \\
&\approx \frac{1}{ \lvert \Sigma \rvert  \Nst} \sum_{n=0}^{\Nst-1} \sum_{\vect{x}, w, z} \;
\tr \left\{
  \propxy{x}{w} \gamma_k
  \fieldx{\eta_n^{\tslice{y_0}}}{w}
  (\fieldx{\eta_n^{\tslice{y_0}}}{z})^{\dagger}
  \propxy{z}{x} \gamma_k
\right\} \;.
\end{align}
The trace turns into a spinor product by using $\gamma^{5}$-Hermiticity of the lattice Dirac operator $D$ and its propagator $S$,
\begin{align}
C(x_0, y_0)
&\approx \frac{1}{ \lvert \Sigma \rvert \Nst} \sum_{n=0}^{\Nst-1} \sum_{\vect{x}, w, z} \;
\sprod{
  \propxy{x}{z}
  \gamma^{5}
  \fieldx{\eta_n^{\tslice{y_0}}}{z}
}{
  \gamma^{5}
  \gamma_k
  \propxy{x}{w}
  \gamma_k
  \fieldx{\eta_n^{\tslice{y_0}}}{w}
} \;.
\end{align}
Finally, the sums on $z$ and $w$ are factorized and can be pulled inside
\begin{align} \label{eq:stoch:C:full}
C(x_0, y_0)
&\approx \frac{1}{ \lvert \Sigma \rvert \Nst} \sum_{n=0}^{\Nst-1} \sum_{\vect{x}} \;
\sprod{
  \fieldx{(\prop
  \gamma^{5}
  \eta_n^{\tslice{y_0}})}{x}
}{
  \gamma^{5}
  \gamma_k
  \fieldx{(\prop \gamma_k
  \eta_n^{\tslice{y_0}})}{x}
} \;.
\end{align}
In this step we define the solutions of the noise sources
\begin{equation} \label{eq:stoch:C:solves}
D \psi_{n}^{\Gamma \tslice{y_0}} = \Gamma \eta_n^{\tslice{y_0}} \;,
\end{equation}
which finally give us the stochastic estimator in terms of a fermion bilinear
\begin{align} \label{eq:stoch:C:full:final}
C(x_0, y_0)
&\approx \frac{1}{\Nst} \sum_{n=0}^{\Nst-1} \; C_n(x_0, y_0) \;, \\
C_n(x_0, y_0)
&= \frac{1}{ \lvert \Sigma \rvert } \sum_{\vect{x}} \;
\sprod{
  \fieldx{\psi_{n}^{\gamma^{5} \tslice{y_0}}}{x}
}{
  \gamma^{5}
  \gamma_k
  \fieldx{\psi_{n}^{\gamma_k \tslice{y_0}}}{x}
} \;.
\end{align}
This expression holds for a fixed time slice $y_0$.
We may uniformly sample different times $y_0 \in \idxtime$ and take the sample average or just average over all times
\begin{equation}
G^{\text{conn}}(t) = \frac{1}{L_0} \sum_{y_0 \in \idxtime}  C(t + y_0, y_0) \;.
\end{equation}

This analysis shows that a stochastic evaluation of \cref{eq:G:corr:connected} amounts of $4 \Nst$ solves of the Dirac equation. \num{4} because for every individual source, we need a solve for every $\gamma$-matrix that appears in the correlator, see \cref{eq:stoch:C:solves}, meaning for $\Gamma \in \{ \gamma^{5}, \gamma_1, \gamma_2, \gamma_3 \}$.

% \subsubsection{Spin diagonal sources}

% \worktodo{todo}

% \subsection{Spectral propagator and LMA}

% Finally, we introduce yet another estimator for \cref{eq:G:corr:connected} using the spectral decomposition of the Hermitian Dirac operator,
% \begin{equation}
% Q = \sum_{n=0}^{12V-1} \lambda_{n} \evec_{n} \evec_{n}^{\dagger} \;,
% \qquad
% Q = \gamma^{5} D \;,
% \qquad
% Q^{\dagger} = Q \;,
% \end{equation}
% into an orthonormal eigenbasis $\mathcal{B} = \{ \evec_n \}_{n=0}^{12V-1}$ with
% \begin{equation}
% Q \evec_{n} = \lambda_{n} \evec_{n} \;,
% \qquad
% \evec_{n}^{\dagger} \evec_{m} = \delta_{nm} \;,
% \end{equation}
% with real eigenvalues $\lambda_{n} \in \mathbb{R}$.
% The same decomposition holds for the propagator
% \begin{equation} \label{eq:prop:all-to-all}
% \propxy{x}{y} = \sum_{n=0}^{12V-1} \frac{1}{\lambda_{n}} \fieldx{\evec_{n}}{x} \fieldx{\evec_{n}^{\dagger}}{y} \gamma^{5} \;,
% \end{equation}
% where the $\gamma^{5}$ at the end is because $S = Q^{-1} \gamma^{5}$.
% Analogously, we emphasize just as \cref{eq:prop:pt-to-all} is an exact point-to-all propagator (no approximation involved), the above is an exact all-to-all propagator.

% In its current state, this propagator is not appropriate for numerical computations, because the full eigen-decomposition into all $12V$ modes is prohibitively expensive.
% Although we can truncate the sum in \cref{eq:prop:all-to-all} and only take the $\Nc \ll 12 V$ modes with lowest magnitude eigenvalues, \ie the largest $\frac{1}{\lambda_{n}}$.
% These should be the modes that contribute most to the propagator.
% To do this, we define an orthogonal projector to the space of the $\Nc$ lowest modes as
% \begin{equation} \label{eq:lma:projector}
% P = \sum_{n=0}^{\Nc-1} \evec_n \evec_n^{\dagger} \;,
% \qquad
% P^{2} = P = P^{\dagger} \;.
% \end{equation}
% The full all-to-all propagator is then decomposed into two terms
% \begin{equation} \label{eq:prop:lma}
% S
% = \underbrace{\sum_{n=0}^{\Nc-1}
%   \frac{1}{\lambda_{n}} \evec_{n} \evec_{n}^{\dagger} \gamma^{5}}_{=\prop_e}
% + \underbrace{(1-P) Q^{-1} \gamma^{5}}_{=\prop_r} \;,
% \end{equation}
% one contribution along the low eigenmode space $\prop_e$ and a remainder $\prop_r$.
% We note that this decomposition is an exact equality.

% The correlator has two slots for propagators.
% We can either plug \cref{eq:prop:lma} in only one slot or in both of them.
% Both options give different valid estimators.
% We will continue with the latter and since the propagator is now a sum of two terms, we obtain four terms for the correlator,
% \begin{equation}
% G^{\text{conn}}(t)
% = G_{ee}^{\text{conn}}(t)
% + G_{er}^{\text{conn}}(t)
% + G_{re}^{\text{conn}}(t)
% + G_{rr}^{\text{conn}}(t) \;.
% % - \frac{a^{3}}{3 \lvert \Omega \rvert}
% % \sum_{y \in \Omega}
% % \sum_{\vect{x}} \;
% % \sum_{k=1}^{3}
% % \tr \left[
% %   \prop(t+y_0, \vect{x}|y) \gamma_k \prop(y|t+y_0, \vect{x}) \gamma_k
% % \right].
% \end{equation}
% The individual terms can be worked out using properties of the $\gamma$-matrices
% \begin{align}
% \{\gamma^{5}, \gamma_{\mu}\} &= 0 \;,        &  (\gamma^{5})^{2} &= \id \;, \\
% \gamma_{\mu}^{\dagger} &= \gamma_{\mu} \;,   &  (\gamma^{5})^{\dagger} &= \gamma^{5} \;.
% \end{align}
% Since their evaluations differ quite substantially, we will discuss them individually in the following.

% For the eigen-eigen term we find
% \begin{multline} \label{eq:Gconn:eigen-eigen}
% G_{ee}^{\text{conn}}(t)
% % = - \frac{a^{3}}{3 V}
% % \sum_{k=1}^{3}
% % \sum_{n,m=0}^{\Nc-1} \frac{1}{\lambda_{n} \lambda_{m}}
% % \sum_{y_0=0}^{L_0-1} \;
% % \sprod{
% %   \evec_{n}^{(y_0)}
% % }{
% %   \gamma^{5}
% %   \gamma_k
% %   \evec_{m}^{(y_0)}
% % } \\
% % \cdot
% % \sprod{
% %   \evec_{m}^{(t+y_0)}
% % }{
% %   \gamma^{5}
% %   \gamma_k
% %   \evec_{n}^{(t+y_0)}
% % }.
% = - \frac{a^{3}}{3 V}
% \sum_{k=1}^{3}
% \sum_{n,m=0}^{\Nc-1} \frac{1}{\lambda_{n} \lambda_{m}}
% \sum_{\vect{x},y} \;
% \sprod{
%   \fieldx{\evec_{n}}{y}
% }{
%   \gamma^{5}
%   \gamma_k
%   \fieldx{\evec_{m}}{y}
% } \\
% \cdot
% \sprod{
%   \fieldx{\evec_{m}}{t+y_0, \vect{x}}
% }{
%   \gamma^{5}
%   \gamma_k
%   \fieldx{\evec_{n}}{t+y_0, \vect{x}}
% } \;,
% \end{multline}
% where the $\sprod{\cdot}{\cdot}$ denotes the standard spinor product.
% Since the eigenmodes are defined on every lattice point, we can easily perform a full volume average of this contribution, $\lvert \Omega \rvert = V$.
% This is characteristic to this type of estimator but also crucial, because now the eigen-eigen term is at its gauge noise level and its variance cannot be lowered further for a fixed gauge config\footnote{Without employing multi-level sampling schemes for the gauge field.}.
% We note that this is also an all-to-all contraction in the index of eigenmodes $n,m$.
% Due to the exact averaging over the subspace of low modes, this class of estimators is known under the name low-mode averaging (LMA)~\cite{Neff_2001,Giusti_2004,DeGrand_2004}.

% The two crossing terms, rest-eigen and eigen-rest, show some symmetry,
% \begin{align}
% G_{er}^{\text{conn}}(t) &=
% \frac{a^{3}}{3 L^{3} \lvert \mathcal{T} \rvert}
% \sum_{y_0 \in \mathcal{T}} \;
% \sum_{n=0}^{\Nc-1} \; \frac{1}{\lambda_{n}}
% \sum_{k=1}^{3} \;
% \sprod{
%   (1-P) S
%   \gamma_k
%   \evec_{n}^{\tslice{y_0}}
% }{
%   \gamma^{5}
%   \gamma_k
%   \evec_{n}^{\tslice{t+y_0}}
% } \;, \\
% G_{re}^{\text{conn}}(t) &=
% \frac{a^{3}}{3 L^{3} \lvert \mathcal{T} \rvert}
% \sum_{y_0 \in \mathcal{T}} \;
% \sum_{n=0}^{\Nc-1} \frac{1}{\lambda_{n}} \;
% \sum_{k=1}^{3} \;
% \sprod{
%   \gamma^{5}
%   \gamma_k
%   \evec_{n}^{\tslice{t+y_0}}
% }{
%   (1-P) S
%   \gamma_k
%   \evec_{n}^{\tslice{y_0}}
% } \;,
% \end{align}
% where we have introduced the time-diluted modes
% \begin{equation}
% \fieldx{\evec_{n}^{\tslice{t}}}{x} =
% \begin{cases}
%   \fieldx{\evec_{n}}{x} & \text{if } x_0 = t \;, \\
%   0 & \text{otherwise} \;,
% \end{cases} 
% \end{equation}
% such that the original mode can be recovered by summing over all times and they are mutually orthogonal but not orthonormal anymore
% \begin{equation}
% \evec_{n} = \sum_{t=0}^{L_0-1} \evec_{n}^{\tslice{t}} \;,
% \qquad
% \sprod{\evec_{n}^{\tslice{t}}}{\evec_{m}^{\tslice{s}}} \sim \delta_{nm} \delta_{ts} \;.
% \end{equation}
% Both cross-terms are in general complex valued, but they are exactly complex conjugates of each other and thus we only need to estimate one of them
% \begin{align}
% G_{\cross}^{\text{conn}}(t)
% &= G_{er}^{\text{conn}}(t) + G_{re}^{\text{conn}}(t) \\
% &= 2 \Re{G_{er}^{\text{conn}}(t)} \;.
% \end{align}

% Clearly the cross-term is expensive to estimate exactly, since we need to solve the Dirac equation on every time-diluted mode for every $\gamma$-matrix we want to evaluate the correlator for, \ie solve the systems
% \begin{equation}
% D \psi = (1-P) \gamma_k \evec_{n}^{\tslice{t}}
% \end{equation}
% for all $k = 1,2,3$, $t \in \stime$ and $n = 0, \ldots, \Nc-1$.
% This makes $3 \Nc L_0$ solves!
% Many improved estimators will not include the whole time extend, all $\gamma$-matrices or all modes but a subset of them.
% Additionally, many LMA-scenarios employ heavily truncated solves on subsets for the above and correct the bias regularly with differences of high precision and truncated solves to obtain an unbiased estimator~\cite{bmw_2017,Kuberski_2023}.
% Alternatively one can introduce a stochastic estimator for the cross-term~\cite{lynch2023,fermi_2023}.
% We called this the \emph{cross-term problem}.

% Another noteworthy variant goes under the name of all-mode averaging (AMA)~\cite{Blum_2012,Blum_2015,CAA,RBC_2018}.
% It has a slightly different propagator decomposition
% \begin{equation}
% \prop
% = \underbrace{\prop - \prop_{\text{AMA}}}_{\prop_{\text{r}}}
% + \underbrace{\sum_{n=0}^{\Nc-1} \frac{1}{\lambda_n} \evec_n \evec_n^{\dagger} \gamma^{5}
% + P_n(Q) P \gamma^{5}}_{\prop_{\text{AMA}}} \;.
% \end{equation}
% Here $P_n(Q)$ is a polynomial in $Q$ usually obtained from an implicitly generated polynomial of a truncated solve (TSM)~\cite{Bali_2009} preconditioned by the eigenmodes and $P$ is defined as in \cref{eq:lma:projector}.
% Here, the TSM does not need bias correction, since the above is a exact decomposition, irrespective of the truncation scheme.
% For this estimator, it is also possible to set $N_c=0$ \cite{Blum_2012}.
% The terms involving $\prop_{r}$ are treated with very few sources, since they do not contribute much to the overall variance.
% Nevertheless, AMA merely moves the problem of the cross-term into the term including $\prop_{\text{AMA}}$ without solving it at its root.
% The polynomial's purpose is to extend the averaging from low modes to all modes, hence the name \emph{all}-mode averaging.
% However, in all scenarios the cost of this term poses one of the major limiters of LMA, a problem which we aim to solve in the remainder of this part.

% Finally, the rest-rest term is the simplest one in the decomposition.
% It is just the standard form \cref{eq:G:corr:connected}, but with $S$ being replaced by $(1-P)S$.
% It can be estimated, for instance with point- or stochastic sources.

% Clearly the cost and the effectiveness of LMA and variants critically depend on the number of low modes $\Nc$ where the spectral sum is truncated.
% Effectiveness of LMA imposes $\Nc$ to be proportional to the lattice volume, a condition hard to satisfy on large lattices.
% We called this the \emph{$V^{2}$-problem}.

%\worktodo{todo}

\section{Summary}
\label{sec:2pt:summary}

%\worktodo{remove lma}

We have introduced the main observable of interest in this thesis -- the connected leading order hadronic vacuum polarization contribution (LO-HVP) to the anomalous magnetic moment of the muon, $a_{\mu}$.
Two common simple strategies for its evaluation have been discussed.
The next chapter will introduce the state-of-the-art method how this observable is evaluated for high-precision studies.
%The connected two point correlation function which dominates the error contribution to the muon $g-2$ comes with high computational cost for sub-percent precision.
%Low-mode averaging as state-of-the-art method for this class of problems was introduced and its main limiters were stated in form of the $V^{2}$- and the cross-term problem.

